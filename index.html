<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Puchus Budget</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Your custom CSS -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-slate-200 text-slate-900 antialiased">
  <div class="max-w-md sm:max-w-5xl mx-auto px-3 sm:px-4 py-4 sm:py-6">

    <!-- ===================== TABS OUTSIDE CARD ===================== -->
    <div class="flex justify-center mb-4">
      <div class="flex w-full sm:w-auto rounded-full bg-slate-50 border border-slate-300 shadow-sm overflow-hidden">
        <button
          type="button"
          class="tab-btn flex-1 text-center px-4 py-2 text-xs sm:text-sm font-medium bg-slate-200 text-slate-900"
          data-tab-target="inputCard"
        >
          Add +
        </button>
        <button
          type="button"
          class="tab-btn flex-1 text-center px-4 py-2 text-xs sm:text-sm font-medium text-slate-600 hover:bg-slate-100"
          data-tab-target="tableCard"
        >
          Transactions
        </button>
        <button
          type="button"
          class="tab-btn flex-1 text-center px-4 py-2 text-xs sm:text-sm font-medium text-slate-600 hover:bg-slate-100"
          data-tab-target="reportCard"
        >
          Report
        </button>
      </div>
    </div>

    <!-- ===================== MAIN CARD ===================== -->
<div
  class="bg-white rounded-2xl shadow-xl border border-slate-300 p-4 sm:p-6 md:p-7
         min-h-[calc(95vh-3rem)] flex flex-col"
>
      <!-- Header with Month/Year + Monthly Budget -->
      <header class="mb-3 sm:mb-4">
        <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
          <!-- Title -->
          <div>
            <h1 class="text-lg sm:text-2xl md:text-3xl font-semibold tracking-tight">
              Puchus Budget
            </h1>
          </div>

          <!-- Month / Year + Monthly Budget -->
          <div class="grid grid-cols-2 gap-2 sm:gap-3 sm:min-w-[260px]">
            <!-- Month / Year picker -->
            <div class="col-span-2 sm:col-span-1">
              <label for="budgetMonthYear"
                     class="block text-[10px] sm:text-[11px] font-medium text-slate-600 mb-0.5">
                Month / Year
              </label>
              <input
                id="budgetMonthYear"
                type="month"
                class="w-full rounded-lg border border-slate-300 px-2.5 py-1 text-sm shadow-sm
                       focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"
              />
            </div>

            <!-- Monthly budget -->
            <div class="col-span-2 sm:col-span-1">
              <label for="budgetAmount"
                     class="block text-[10px] sm:text-[11px] font-medium text-slate-600 mb-0.5">
                Monthly budget
              </label>
              <input
                id="budgetAmount"
                type="number"
                min="0"
                step="0.01"
                placeholder="e.g. 1500"
                class="w-full rounded-lg border border-slate-300 px-2.5 py-1 text-sm shadow-sm
                       focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"
              />
            </div>
          </div>
        </div>
      </header>

      <!-- Cards Wrapper -->
      <div class="space-y-3 sm:space-y-4">

        <!-- ===================== INPUT CARD (Tab 1) ===================== -->
        <section id="inputCard" class="bg-slate-50 rounded-xl border border-slate-200 p-3 sm:p-4">
          <div class="mb-2">
<p
  id="monthHeaderPrimary"
  class="flex items-baseline justify-between gap-2 text-sm sm:text-base font-semibold text-slate-900"
>
  <!-- JS will overwrite this content -->
  <span>Total $0.00</span>
  <span class="text-[11px] sm:text-xs font-normal text-slate-500">
    0 transactions
  </span>
</p>

            <p
              id="monthHeaderSecondary"
              class="mt-0.5 text-[11px] sm:text-xs text-slate-600"
            >
              Available budget: $0.00
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-5 gap-2 sm:gap-3 mb-3">
            <!-- Date -->
            <div>
              <label for="trxDate" class="block text-[10px] sm:text-[11px] font-medium text-slate-600 mb-0.5">
                Date
              </label>
              <input
                id="trxDate"
                type="date"
                class="w-full rounded-lg border border-slate-300 px-2.5 py-1 text-sm shadow-sm
                       focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"
              />
            </div>

            <!-- Description -->
            <div class="md:col-span-2">
              <label for="trxDesc" class="block text-[10px] sm:text-[11px] font-medium text-slate-600 mb-0.5">
                Description
              </label>
              <input
                id="trxDesc"
                type="text"
                placeholder="Publix groceries, Uber, Rent..."
                class="w-full rounded-lg border border-slate-300 px-2.5 py-1 text-sm shadow-sm
                       focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"
              />
            </div>

            <!-- Category -->
            <div>
              <label for="trxCategory" class="block text-[10px] sm:text-[11px] font-medium text-slate-600 mb-0.5">
                Category
              </label>
              <div class="relative" id="categoryWrapper">
                <button
                  id="categoryBtn"
                  type="button"
                  class="w-full rounded-lg border border-slate-300 px-3 py-1.5 text-sm bg-white flex justify-between items-center"
                >
                  <span id="categorySelected">Select category</span>
                  <span class="text-slate-400">▾</span>
                </button>

                <div
                  id="categoryMenu"
                  class="absolute left-0 right-0 mt-1 bg-white border border-slate-200 rounded-lg shadow-lg hidden z-20"
                >
                  <div class="category-item cat-groceries"  data-cat="Groceries">Groceries</div>
                  <div class="category-item cat-dining"     data-cat="Dining out">Dining out</div>
                  <div class="category-item cat-personal"   data-cat="Personal spending">Personal spending</div>
                  <div class="category-item cat-housing"    data-cat="Housing">Housing</div>
                  <div class="category-item cat-transport"  data-cat="Transportation">Transportation</div>
                  <div class="category-item cat-subs"       data-cat="Subscriptions">Subscriptions</div>
                  <div class="category-item cat-health"     data-cat="Health">Health</div>
                  <div class="category-item cat-utilities"  data-cat="Utilities">Utilities</div>
                  <div class="category-item cat-savings"    data-cat="Savings">Savings</div>
                  <div class="category-item cat-misc"       data-cat="Miscellaneous">Miscellaneous</div>
                </div>
              </div>
            </div>

            <!-- Amount -->
            <div>
              <label for="trxAmount" class="block text-[10px] sm:text-[11px] font-medium text-slate-600 mb-0.5">
                Amount
              </label>
              <input
                id="trxAmount"
                type="number"
                min="0"
                step="0.01"
                placeholder="e.g. 45.23"
                class="w-full rounded-lg border border-slate-300 px-2.5 py-1 text-sm shadow-sm
                       focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500"
              />
            </div>
          </div>

<!-- ===================== ACCOUNT TOGGLE ===================== -->
<div class="mt-1 mb-3 flex justify-center">
  <div
    id="accountToggle"
    class="inline-flex rounded-full border border-slate-300 bg-slate-50 p-0.5 text-xs sm:text-sm"
  >
    <!-- Ayush -->
    <button
      type="button"
      data-account="Ayush"
      class="px-3 py-1 rounded-full transition-colors"
    >
      Ayush
    </button>

    <!-- Joint -->
    <button
      type="button"
      data-account="Joint"
      class="px-3 py-1 rounded-full transition-colors"
    >
      Joint
    </button>

    <!-- Nupur -->
    <button
      type="button"
      data-account="Nupur"
      class="px-3 py-1 rounded-full transition-colors"
    >
      Nupur
    </button>
  </div>
</div>

          <button
            id="addTransactionBtn"
            class="w-full sm:w-auto inline-flex items-center justify-center rounded-xl bg-emerald-700 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-600 transition"
          >
            Add Transaction
          </button>
        </section>

<!-- ===================== TABLE CARD (Tab 2) ===================== -->
<section
  id="tableCard"
  class="hidden bg-slate-50 rounded-xl border border-slate-200 p-0 min-h-[65vh] flex flex-col"
>
  <!-- Header / summary (with min-height) -->
  <div class="border-b border-slate-200 px-3 sm:px-4 py-2.5 min-h-[64px] flex items-center">
    <div class="flex flex-col w-full">
      <p
        id="tableHeaderPrimary"
        class="flex items-baseline gap-2 text-sm sm:text-base font-semibold text-slate-900"
      >
        <span>Total $0.00</span>
        <span class="ml-auto text-[11px] sm:text-xs font-normal text-slate-500">
          0 transactions
        </span>
      </p>
      <p
        id="tableHeaderSecondary"
        class="text-[11px] sm:text-xs text-slate-600"
      >
        Available budget: —
      </p>
    </div>
  </div>

  <!-- Table wrapper grows to fill remaining height -->
  <div class="flex-1 overflow-x-auto px-0 pb-1">
    <table class="min-w-full text-[11px] sm:text-xs md:text-sm">
      <thead class="bg-slate-100 text-slate-700">
        <tr class="text-left">
          <th class="relative px-2 sm:px-3 py-2 font-medium">
  <button
    id="dateHeaderFilterBtn"
    type="button"
    class="inline-flex items-center gap-1 text-slate-700 hover:text-slate-900"
  >
    <span>Date</span>
    <!-- filter dot -->
    <span
      id="dateHeaderFilterDot"
      class="inline-block w-1.5 h-1.5 rounded-full opacity-0 ml-1"
    ></span>
  </button>

  <!-- Multi-select dropdown -->
  <div
    id="accountFilterMenu"
    class="absolute left-0 mt-1 w-32 bg-white border border-slate-200 rounded-lg shadow-lg text-xs py-2 hidden z-20"
  >
    <!-- ALL -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-filter-multi="All" class="mr-2">
      All
    </label>

    <!-- AYUSH -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-filter-multi="Ayush" class="mr-2">
      Ayush
    </label>

    <!-- JOINT -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-filter-multi="Joint" class="mr-2">
      Joint
    </label>

    <!-- NUPUR -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-filter-multi="Nupur" class="mr-2">
      Nupur
    </label>
  </div>
</th>


          <th class="px-2 sm:px-3 py-2 font-medium">Description</th>
<th class="relative px-2 sm:px-3 py-2 font-medium">
  <button
    id="categoryHeaderFilterBtn"
    type="button"
    class="inline-flex items-center gap-1 text-slate-700 hover:text-slate-900"
  >
    <span>Category</span>
  </button>

  <!-- Category multi-select dropdown -->
  <div
    id="categoryFilterMenu"
    class="absolute left-0 mt-1 w-40 bg-white border border-slate-200 rounded-lg shadow-lg text-xs py-2 hidden z-20"
  >
    <!-- ALL -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="All" class="mr-2" checked>
      All
    </label>

    <!-- Groceries -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Groceries" class="mr-2">
      Groceries
    </label>

    <!-- Dining out -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Dining out" class="mr-2">
      Dining out
    </label>

    <!-- Personal spending -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Personal spending" class="mr-2">
      Personal spending
    </label>

    <!-- Housing -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Housing" class="mr-2">
      Housing
    </label>

    <!-- Transportation -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Transportation" class="mr-2">
      Transportation
    </label>

    <!-- Subscriptions -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Subscriptions" class="mr-2">
      Subscriptions
    </label>

    <!-- Utilities -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Utilities" class="mr-2">
      Utilities
    </label>

    <!-- Savings -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Savings" class="mr-2">
      Savings
    </label>

    <!-- Health -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Health" class="mr-2">
      Health
    </label>

    <!-- Miscellaneous -->
    <label class="flex items-center px-2 py-1 cursor-pointer hover:bg-slate-100">
      <input type="checkbox" data-cat-filter-multi="Miscellaneous" class="mr-2">
      Miscellaneous
    </label>
  </div>
</th>

          <th class="px-2 sm:px-3 py-2 font-medium text-right">Amount</th>
        </tr>
      </thead>
      <tbody
        id="transactionsTableBody"
        class="divide-y divide-slate-100 bg-white"
      ></tbody>
    </table>
  </div>
</section>



<!-- ===================== REPORT CARD (Tab 3) ===================== -->
<section
  id="reportCard"
  class="hidden bg-slate-50 rounded-xl border border-slate-200 p-4 flex flex-col gap-4"
>
  <div class="flex items-center justify-between">
    <h2 class="text-sm sm:text-base font-semibold">Spending Flow</h2>
    <p class="text-[11px] sm:text-xs text-slate-500">
      For the selected month & filters
    </p>
  </div>

  <!-- Sankey chart -->
  <div id="reportSankey" class="w-full h-72 sm:h-80"></div>

  <!-- Details: line items for clicked category -->
  <div id="reportDetails" class="border-t border-slate-200 pt-3">
    <p class="text-[11px] sm:text-xs text-slate-500">
      Click a category node to see line items here.
    </p>
  </div>
</section>



      </div>
    </div>
  </div>








  
  <!-- Plotly for Sankey chart -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

  <!-- Your main app logic -->
  <script src="script.js"></script>

  <!-- Tab switcher + default month/year -->
  <script>
    (function () {
      const tabButtons = document.querySelectorAll(".tab-btn");
      const cards = {
        inputCard: document.getElementById("inputCard"),
        tableCard: document.getElementById("tableCard"),
        reportCard: document.getElementById("reportCard"),
      };

function setActiveTab(targetId) {
  Object.keys(cards).forEach(id => {
    cards[id].classList.toggle("hidden", id !== targetId);
  });

  tabButtons.forEach(btn => {
    const isActive = btn.getAttribute("data-tab-target") === targetId;
    btn.className =
      "tab-btn flex-1 text-center px-4 py-2 text-xs sm:text-sm font-medium transition-colors duration-150 " +
      (isActive
        ? "bg-slate-200 text-slate-900"
        : "bg-transparent text-slate-600 hover:bg-slate-100");
  });

  // ⭐ New: when Report tab is shown, render Sankey with correct width
  if (targetId === "reportCard" && typeof window.refreshUI === "function") {
    setTimeout(() => {
      window.refreshUI(); // calls renderReportSankey()
      const el = document.getElementById("reportSankey");
      if (window.Plotly && el) {
        window.Plotly.Plots.resize(el);
      }
    }, 0);
  }
}


      tabButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-tab-target");
          setActiveTab(target);
        });
      });

      // Default tab
      setActiveTab("inputCard");

      // Default Month/Year to today if empty
      const budgetMonthInput = document.getElementById("budgetMonthYear");
      if (budgetMonthInput && !budgetMonthInput.value) {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, "0");
        budgetMonthInput.value = `${year}-${month}`;
      }
    })();
  </script>

  <!-- Delete confirmation overlay -->
  <div
    id="deleteOverlay"
    class="fixed inset-0 bg-slate-900/40 flex items-center justify-center z-50 hidden"
  >
    <div class="bg-white rounded-xl shadow-xl border border-slate-200 max-w-sm w-[90%] p-4">
      <h3 class="text-sm sm:text-base font-semibold text-slate-900 mb-2">
        Delete this transaction?
      </h3>
      <p id="deleteOverlayText" class="text-xs sm:text-sm text-slate-600 mb-4">
        <!-- Filled dynamically -->
      </p>
      <div class="flex justify-end gap-2">
        <button
          id="deleteCancelBtn"
          class="px-3 py-1.5 text-xs sm:text-sm rounded-lg border border-slate-300 text-slate-700 bg-white hover:bg-slate-50"
        >
          Cancel
        </button>
        <button
          id="deleteConfirmBtn"
          class="px-3 py-1.5 text-xs sm:text-sm rounded-lg bg-rose-600 text-white font-semibold hover:bg-rose-700"
        >
          Delete
        </button>
      </div>
    </div>
  </div>
</body>
</html>
